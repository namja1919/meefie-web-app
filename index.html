<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MEEFIE - Celebrity Photo Staking</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .gradient-text { background: linear-gradient(to right, #007bff, #ffeb3b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .btn-yellow { background: linear-gradient(to right, #f57c00, #ffeb3b); }
    .card { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-900 to-indigo-900 text-white min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const TIER_REWARDS = { Bronze: 20, Silver: 30, Gold: 40, Platinum: 50, Diamond: 60 };
    const PROFILE_TIERS = [
      { name: "STARTER", cost: 0, maxStake: 1 },
      { name: "EXPLORER", cost: 5000, maxStake: 2 },
      { name: "INFLUENCER", cost: 20000, maxStake: 5 },
      { name: "ELITE", cost: 50000, maxStake: 10 },
      { name: "PRESTIGE", cost: 100000, maxStake: Infinity }
    ];

    function App() {
      const [user, setUser] = useState(null);
      const [step, setStep] = useState("login");
      const [photo, setPhoto] = useState(null);
      const [celebrity, setCelebrity] = useState(null);
      const [celebrityTier, setCelebrityTier] = useState("");
      const [wallet, setWallet] = useState("");
      const [kycSubmitted, setKycSubmitted] = useState(false);
      const [profileTier, setProfileTier] = useState("STARTER");
      const [stakedPhotos, setStakedPhotos] = useState([]);
      const [nftPhotos, setNftPhotos] = useState([]);

      const videoRef = useRef(null);
      const canvasRef = useRef(null);

      // Login
      const handleLogin = () => {
        setUser({ name: "John Doe", email: "john@example.com" });
        setStep("camera");
      };

      // Start camera
      useEffect(() => {
        if (step === "camera") {
          navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { if (videoRef.current) videoRef.current.srcObject = stream; })
            .catch(err => alert("Camera error: " + err.message));
        }
      }, [step]);

      // Capture photo
      const capturePhoto = () => {
        const canvas = canvasRef.current;
        const video = videoRef.current;
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        setPhoto(canvas.toDataURL("image/png"));
        setStep("result");

        // Simulate AI detection
        setTimeout(() => {
          const celebs = ["Taylor Swift", "Leonardo DiCaprio", "Beyonc√©"];
          const detected = celebs[Math.floor(Math.random() * celebs.length)];
          const tiers = Object.keys(TIER_REWARDS);
          const tier = tiers[Math.floor(Math.random() * tiers.length)];
          setCelebrity(detected);
          setCelebrityTier(tier);
          setStep("action");
        }, 1500);
      };

      // Connect MetaMask
      const connectWallet = async () => {
        if (window.ethereum) {
          try {
            const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
            setWallet(accounts[0]);
          } catch (err) {
            alert("Wallet denied.");
          }
        } else {
          alert("Install MetaMask");
        }
      };

      // Convert to NFT
      const convertToNFT = () => {
        if (!wallet) return alert("Connect wallet first.");
        if (confirm("Pay 10,000 MFT to mint NFT?")) {
          setNftPhotos([...nftPhotos, photo]);
          setStep("dashboard");
        }
      };

      // Stake photo
      const stakePhoto = () => {
        const max = PROFILE_TIERS.find(t => t.name === profileTier).maxStake;
        if (stakedPhotos.length >= max) return alert(`Max ${max} staked photos as ${profileTier}`);
        setStakedPhotos([...stakedPhotos, { photo, tier: celebrityTier, apy: TIER_REWARDS[celebrityTier] }]);
        setStep("dashboard");
      };

      // Upgrade profile
      const upgradeTier = (e) => {
        const tier = e.target.value;
        if (confirm(`Upgrade to ${tier}?`)) setProfileTier(tier);
      };

      // Submit KYC
      const submitKYC = () => {
        setKycSubmitted(true);
        alert("KYC submitted. Verification in 3-5 days.");
      };

      // Logout
      const logout = () => {
        setUser(null);
        setStep("login");
      };

      return (
        <div className="container mx-auto px-4 py-8">
          {/* Header */}
          <header className="flex justify-between items-center mb-8">
            <h1 className="text-3xl font-bold gradient-text">MEEFIE</h1>
            {user && <button onClick={logout} className="bg-red-600 px-3 py-1 rounded">Logout</button>}
          </header>

          {/* Login */}
          {step === "login" && (
            <div className="text-center max-w-md mx-auto">
              <h2 className="text-3xl font-bold mb-6">Welcome to MEEFIE</h2>
              <button onClick={handleLogin} className="btn-yellow text-black px-6 py-3 rounded-full font-bold">
                üî¥ Continue with Google
              </button>
            </div>
          )}

          {/* Camera */}
          {step === "camera" && (
            <div className="text-center">
              <h2 className="text-2xl font-bold mb-4">üì∏ Take a Photo</h2>
              <video ref={videoRef} autoPlay className="w-full max-w-lg mx-auto rounded shadow-lg" />
              <canvas ref={canvasRef} className="hidden"></canvas>
              <button onClick={capturePhoto} className="mt-4 bg-green-600 px-8 py-3 rounded-full font-bold">
                Capture
              </button>
            </div>
          )}

          {/* AI Result */}
          {step === "action" && (
            <div className="text-center max-w-lg mx-auto">
              <h2 className="text-2xl font-bold text-yellow-400">üéâ {celebrity} Detected!</h2>
              <p>Tier: <strong>{celebrityTier}</strong> (APY: {TIER_REWARDS[celebrityTier]}%)</p>
              <img src={photo} alt="Captured" className="w-full rounded mt-4" />
              <div className="space-y-3 mt-6">
                <button onClick={convertToNFT} className="w-full bg-purple-600 p-3 rounded">
                  üíæ Convert to NFT (10,000 MFT)
                </button>
                <button onClick={stakePhoto} className="w-full bg-green-600 p-3 rounded">
                  üìà Stake Photo (Earn {TIER_REWARDS[celebrityTier]}% APY)
                </button>
              </div>
            </div>
          )}

          {/* Dashboard */}
          {step === "dashboard" && (
            <div className="max-w-4xl mx-auto">
              <h2 className="text-3xl font-bold mb-6">Dashboard</h2>
              <div className="grid md:grid-cols-2 gap-6">
                <div className="bg-white/10 p-6 rounded-lg">
                  <h3 className="font-bold">üë§ Profile</h3>
                  <p>Tier: {profileTier}</p>
                  <p>Wallet: {wallet ? `${wallet.slice(0,6)}...${wallet.slice(-4)}` : "Not connected"}</p>
                  <button onClick={connectWallet} className="mt-2 w-full bg-blue-600 px-4 py-2 rounded">
                    {wallet ? "‚úÖ Connected" : "üîå Connect Wallet"}
                  </button>
                  <select onChange={upgradeTier} className="mt-2 w-full bg-gray-700 p-2 rounded">
                    {PROFILE_TIERS.map(t => <option key={t.name}>{t.name}</option>)}
                  </select>
                </div>
                <div className="bg-white/10 p-6 rounded-lg">
                  <h3 className="font-bold">üìä Stats</h3>
                  <p>üì∏ Photos Taken: {stakedPhotos.length + nftPhotos.length}</p>
                  <p>üñºÔ∏è NFTs: {nftPhotos.length}</p>
                  <p>üìà Staked: {stakedPhotos.length}</p>
                  <p>üí∞ Estimated APY: {stakedPhotos.reduce((a, b) => a + b.apy, 0)}%</p>
                </div>
                <div className="bg-white/10 p-6 rounded-lg">
                  <h3 className="font-bold">üîê KYC</h3>
                  <button onClick={submitKYC} className="w-full bg-yellow-600 px-4 py-2 rounded">
                    {kycSubmitted ? "‚úÖ Submitted" : "üìÑ Submit KYC"}
                  </button>
                </div>
                <div className="bg-white/10 p-6 rounded-lg">
                  <h3 className="font-bold">üñºÔ∏è Staked Photos</h3>
                  {stakedPhotos.length === 0 ? (
                    <p>No photos staked yet.</p>
                  ) : (
                    stakedPhotos.map((p, i) => (
                      <div key={i} className="mb-2 p-2 bg-black/30 rounded flex items-center gap-2">
                        <img src={p.photo} alt="Staked" className="w-12 h-12 object-cover rounded" />
                        <div className="text-left text-sm">
                          <div>{p.tier} Tier</div>
                          <div>APY: {p.apy}%</div>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
